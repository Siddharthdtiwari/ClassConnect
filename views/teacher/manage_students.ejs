<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Students</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Inter", sans-serif;
    }

    .bg-brand-background {
      background-color: #f3f4f6;
      background-image: linear-gradient(120deg, #f3e8ff 0%, #eef2f3 100%);
    }

    .text-brand-purple {
      color: #5d3a9b;
    }

    .border-brand-purple {
      border-color: #5d3a9b;
    }

    .btn-outline-purple {
      color: #5d3a9b;
      border: 1px solid #5d3a9b;
      font-weight: 600;
      transition: background-color 0.3s ease, color 0.3s ease,
        border-color 0.3s ease;
      border-radius: 0.5rem;
    }

    .btn-outline-purple:hover {
      background-color: #bde045;
      color: #333;
      border-color: #bde045;
    }

    .table-auto {
      width: 100%;
      border-collapse: collapse;
    }

    .table-auto th,
    .table-auto td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    .table-auto th {
      background-color: #f9fafb;
      color: #4b5563;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.75rem;
    }
  </style>
</head>
<%- include('../partials/background') %>

<body class="text-gray-800">
  <div class="content-container container mx-auto p-4 sm:p-6 lg:p-8 min-h-screen">
    <header class="mb-8">
      <a href="/teacher/dashboard" class="text-brand-purple hover:underline mb-4 block">&larr; Back to Dashboard</a>
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900">
        Manage Students
      </h1>
      <p class="text-gray-600 mt-1">
        Search and view details for all students.
      </p>
    </header>

    <div class="bg-white p-8 rounded-xl shadow-lg">
      <div class="mb-6 text-center">
        <button onclick="window.location.href='/teacher/add_student'" class="py-2 px-4 btn-outline-purple">
          + Add New Student
        </button>
      </div>

      <!-- Filter & Search Bar -->
      <div class="flex flex-col sm:flex-row gap-4 mb-6">
        <!-- Standard Filter -->
        <select id="class-filter" class="flex-grow sm:flex-grow-0 sm:w-1/3 px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-brand-purple focus:ring focus:ring-brand-purple focus:ring-opacity-50 transition duration-150 ease-in-out">
          <option value="all">All Standards</option>
          <option value="0">Grade 0</option>
          <option value="1">Grade 1</option>
          <option value="2">Grade 2</option>
          <option value="3">Grade 3</option>
          <option value="4">Grade 4</option>
          <option value="5">Grade 5</option>
          <option value="6">Grade 6</option>
          <option value="7">Grade 7</option>
          <option value="8">Grade 8</option>
          <option value="9">Grade 9</option>
          <option value="10">Grade 10</option>
        </select>
        <!-- Search Bar -->
        <input type="text" id="student-search" placeholder="Search by student name or ID..." class="flex-grow px-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-brand-purple focus:ring focus:ring-brand-purple focus:ring-opacity-50 transition duration-150 ease-in-out" />
      </div>

      <!-- Student Table -->
      <div class="overflow-x-auto">
        <table class="table-auto rounded-lg overflow-hidden">
          <thead>
            <tr>
              <th>Student Name</th>
              <th>Student ID</th>
              <th>Standard</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="student-list">
            <% students.forEach(student=> { %>
            <tr data-class="<%= student.standard %>">
              <td><%= student.studentName %></td>
              <td><%= student.studentId %></td>
              <td><%= student.standard %></td>
              <td>
                <button onclick="window.location.href='/teacher/view_profile/<%= student._id %>'" class="text-sm text-brand-purple hover:underline view-profile-btn">
                  View Profile
                </button>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const searchInput = document.getElementById("student-search");
      const classFilter = document.getElementById("class-filter");
      const studentTableBody = document.getElementById("student-list");

      // Function to filter and search the table
      const filterAndSearch = () => {
        const searchText = searchInput.value.toLowerCase();
        const selectedClass = classFilter.value;

        // Always get all rows dynamically
        const rows = studentTableBody.querySelectorAll("tr");

        rows.forEach((row) => {
          const studentName = row
            .querySelector("td:first-child")
            .textContent.toLowerCase();
          const studentId = row
            .querySelector("td:nth-child(2)")
            .textContent.toLowerCase();
          const studentClass = row.dataset.class;

          const matchesSearch =
            searchText === "" ||
            studentName.includes(searchText) ||
            studentId.includes(searchText);
          const matchesClass =
            selectedClass === "all" || studentClass == selectedClass;

          if (matchesSearch && matchesClass) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      };

      // Event listeners
      searchInput.addEventListener("input", filterAndSearch);
      classFilter.addEventListener("change", filterAndSearch);

      // Optional: Profile button click
      studentTableBody.addEventListener("click", (event) => {
        if (event.target.classList.contains("view-profile-btn")) {
          const studentName = event.target
            .closest("tr")
            .querySelector("td:first-child").textContent;
          console.log(`Navigating to profile page for ${studentName}.`);
        }
      });
    });
  </script>
</body>

</html>