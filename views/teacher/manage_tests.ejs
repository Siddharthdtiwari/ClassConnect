<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Tests</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }

      .text-brand-purple {
        color: #5d3a9b;
      }

      .btn-outline-purple {
        color: #5d3a9b;
        border: 1px solid #5d3a9b;
        font-weight: 600;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
      }

      .btn-outline-purple:hover {
        background-color: #bde045;
        color: #333;
        border-color: #bde045;
      }

      .table-auto {
        width: 100%;
        border-collapse: collapse;
      }

      .table-auto th,
      .table-auto td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }

      .table-auto th {
        background-color: #f9fafb;
        color: #4b5563;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
      }
    </style>
  </head>
  <%- include('../partials/background') %>

  <body class="text-gray-800">
    <div
      class="content-container container mx-auto p-4 sm:p-6 lg:p-8 min-h-screen"
    >
      <header
        class="mb-8 flex flex-col md:flex-row justify-between items-center gap-4"
      >
        <div>
          <a
            href="/teacher/dashboard"
            class="text-brand-purple hover:underline mb-2 block"
            >&larr; Back to Dashboard</a
          >
          <h1 class="text-3xl md:text-4xl font-bold text-gray-900">
            Manage Tests
          </h1>
          <p class="text-gray-600 mt-1">View and manage all tests.</p>
        </div>
        <button
          onclick="window.location.href='/teacher/add_test'"
          class="py-2 px-4 btn-outline-purple"
        >
          + Add Test
        </button>
      </header>

      <div class="flex flex-col sm:flex-row gap-4 mb-6">
        <select
          id="standard-filter"
          class="px-4 py-2 rounded-lg border-gray-300 shadow-sm focus:border-brand-purple focus:ring focus:ring-brand-purple focus:ring-opacity-50"
        >
          <option value="all">All Standards</option>
          <% for(let i=0;i<=10;i++){ %>
          <option value="<%=i%>">Grade <%= i %></option>
          <% } %>
        </select>
        <input
          type="text"
          id="test-search"
          placeholder="Search by test name, subject, or topic..."
          class="flex-grow px-4 py-2 rounded-lg border-gray-300 shadow-sm focus:border-brand-purple focus:ring focus:ring-brand-purple focus:ring-opacity-50"
        />
      </div>

      <div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
        <table class="table-auto rounded-lg overflow-hidden">
          <thead>
            <tr>
              <th>Test Name</th>
              <th>Standard</th>
              <th>Subject</th>
              <th>Topic</th>
              <th>Total Marks</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="test-list">
            <% tests.forEach(test=> { %>
            <tr data-standard="<%= test.standard %>">
              <td class="whitespace-nowrap"><%= test.testName %></td>
              <td><%= test.standard %></td>
              <td><%= test.subject %></td>
              <td class="whitespace-nowrap"><%= test.topic %></td>
              <td><%= test.totalMarks %></td>
              <td class="flex gap-2">
                <% if (test.questionPaper) { %>
                <a
                  href="<%= test.questionPaper %>"
                  download
                  class="text-green-600 hover:underline"
                  >Download QP</a
                >
                <% } else { %>
                <span class="text-gray-400">No QP</span>
                <% } %>
                <form
                  action="/teacher/delete_test/<%= test._id %>"
                  method="POST"
                  onsubmit="return confirm('Are you sure you want to delete this test?');"
                >
                  <button type="submit" class="text-red-600 hover:underline">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.getElementById("test-search");
        const standardFilter = document.getElementById("standard-filter");
        const testTableBody = document.getElementById("test-list");

        const filterAndSearch = () => {
          const searchText = searchInput.value.toLowerCase();
          const selectedStandard = standardFilter.value;

          testTableBody.querySelectorAll("tr").forEach((row) => {
            const testName = row
              .querySelector("td:first-child")
              .textContent.toLowerCase();
            const subject = row
              .querySelector("td:nth-child(3)")
              .textContent.toLowerCase();
            const topic = row
              .querySelector("td:nth-child(4)")
              .textContent.toLowerCase();
            const rowStandard = row.dataset.standard;

            const matchesSearch =
              searchText === "" ||
              testName.includes(searchText) ||
              subject.includes(searchText) ||
              topic.includes(searchText);
            const matchesStandard =
              selectedStandard === "all" || rowStandard === selectedStandard;

            row.style.display = matchesSearch && matchesStandard ? "" : "none";
          });
        };

        searchInput.addEventListener("input", filterAndSearch);
        standardFilter.addEventListener("change", filterAndSearch);
      });
    </script>
  </body>
</html>
